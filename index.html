<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equatino! Bingo Card Generator</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- QRCode.js for generating QR codes -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Google Fonts for a modern look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            color: #f9fafb; /* text-gray-50 */
        }
        /* A simple fade-in animation for generated content */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <!-- =============================================================== -->
    <!-- PARTICIPANT VIEW: Shown when a '?seed=' is in the URL          -->
    <!-- =============================================================== -->
    <div id="participant-view" class="hidden w-full max-w-md text-center">
        <div class="mb-6">
            <h1 class="text-5xl font-black tracking-tight text-cyan-400">Equatino!</h1>
            <p class="text-gray-400 mt-1">Your Personal Bingo Card</p>
        </div>
        <div id="bingo-card" class="fade-in grid grid-cols-5 gap-2 bg-gray-800 p-3 rounded-lg shadow-2xl w-full aspect-square">
            <!-- Static bingo card cells will be generated by JavaScript -->
        </div>
         <p class="text-gray-500 text-xs mt-4">Card ID: <span id="card-id"></span></p>
    </div>

    <!-- =============================================================== -->
    <!-- ORGANIZER VIEW: Shown when no '?seed=' is in the URL            -->
    <!-- =============================================================== -->
    <div id="organizer-view" class="hidden w-full max-w-md text-center">
        <h1 class="text-3xl font-bold text-cyan-400">Organizer Panel</h1>
        <p class="text-gray-400 mb-6">Generate a unique QR code for participants</p>
        <button id="generate-link-btn" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-cyan-300">
            Generate New QR Code
        </button>
        <div id="qr-code-container" class="mt-6 p-4 border-2 border-dashed border-gray-700 rounded-lg hidden fade-in">
             <p class="text-gray-400 mb-2 text-sm">Project this QR code for participants to scan.</p>
            <div id="qrcode" class="flex justify-center bg-white p-4 rounded-md mx-auto w-fit"></div>
            <div class="mt-4">
                <p class="text-gray-400 text-sm">Or share this link directly:</p>
                <input type="text" id="generated-link" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 mt-1 text-center text-gray-300" readonly>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const BINGO_MIN_NUMBER = 1;
        const BINGO_MAX_NUMBER = 75; // Standard 75-ball bingo
        const GRID_SIZE = 5;

        // --- DOM ELEMENT REFERENCES ---
        const participantView = document.getElementById('participant-view');
        const organizerView = document.getElementById('organizer-view');
        const bingoCard = document.getElementById('bingo-card');
        const cardIdSpan = document.getElementById('card-id');
        const generateLinkBtn = document.getElementById('generate-link-btn');
        const qrCodeContainer = document.getElementById('qr-code-container');
        const qrcodeDiv = document.getElementById('qrcode');
        const generatedLinkInput = document.getElementById('generated-link');

        /**
         * A simple seeded pseudo-random number generator (PRNG).
         * This is crucial for fairness, as it ensures the same seed string
         * will always produce the exact same sequence of "random" numbers.
         * @param {string} seed - The seed to initialize the generator.
         * @returns {function} A function that returns a new pseudo-random number each time it's called.
         */
        function createSeededRandom(seed) {
            let h = 1779033703 ^ seed.length;
            for (let i = 0; i < seed.length; i++) {
                h = Math.imul(h ^ seed.charCodeAt(i), 3432918353);
                h = h << 13 | h >>> 19;
            }
            return function() {
                h = Math.imul(h ^ h >>> 16, 2246822507);
                h = Math.imul(h ^ h >>> 13, 3266489909);
                return (h ^= h >>> 16) >>> 0;
            }
        }
        
        /**
         * Generates a shuffled array of numbers from min to max using a seeded PRNG.
         * @param {function} randomFunc - The seeded random function to use for shuffling.
         * @param {number} min - The minimum number in the range (inclusive).
         * @param {number} max - The maximum number in the range (inclusive).
         * @returns {number[]} A deterministically shuffled array of numbers.
         */
        function getShuffledNumbers(randomFunc, min, max) {
            const allNumbers = Array.from({ length: max - min + 1 }, (_, i) => i + min);
            // Fisher-Yates shuffle algorithm, using our seeded random function for deterministic results.
            for (let i = allNumbers.length - 1; i > 0; i--) {
                const j = randomFunc() % (i + 1);
                [allNumbers[i], allNumbers[j]] = [allNumbers[j], allNumbers[i]];
            }
            return allNumbers;
        }

        /**
         * Creates and populates the bingo card grid in the DOM based on a seed.
         * @param {string} seed - The seed used to generate this specific card.
         */
        function createSeededCard(seed) {
            const randomFunc = createSeededRandom(seed);
            const shuffledNumbers = getShuffledNumbers(randomFunc, BINGO_MIN_NUMBER, BINGO_MAX_NUMBER);
            // We need 24 numbers for a 5x5 grid with a free center.
            const cardNumbers = shuffledNumbers.slice(0, GRID_SIZE * GRID_SIZE - 1);
            
            bingoCard.innerHTML = ''; // Clear any previous card content
            const centerIndex = Math.floor((GRID_SIZE * GRID_SIZE) / 2);

            let numberIndex = 0;
            for (let i = 0; i < GRID_SIZE * GRID_SIZE; i++) {
                const cell = document.createElement('div');
                cell.className = 'flex items-center justify-center text-2xl font-bold rounded-md bg-gray-900 aspect-square';

                if (i === centerIndex) {
                    cell.textContent = 'FREE';
                    cell.classList.remove('bg-gray-900');
                    cell.classList.add('bg-cyan-600', 'text-sm');
                } else {
                    cell.textContent = cardNumbers[numberIndex];
                    numberIndex++;
                }
                bingoCard.appendChild(cell);
            }
            cardIdSpan.textContent = seed;
        }

        /**
         * Generates a new unique URL with a random seed and displays its QR code.
         */
        function handleGenerateLink() {
            // Generate a simple, random 8-character string for the seed.
            const newSeed = Math.random().toString(36).substring(2, 10);
            
            // Construct the new URL. When hosted, this will be the public URL.
            const baseUrl = window.location.href.split('?')[0];
            const newUrl = `${baseUrl}?seed=${newSeed}`;

            // Update the text input field to show the generated link.
            generatedLinkInput.value = newUrl;

            // Clear any old QR code and create the new one.
            qrcodeDiv.innerHTML = '';
            new QRCode(qrcodeDiv, {
                text: newUrl,
                width: 256,
                height: 256,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H // High error correction
            });
            // Make the QR code container visible.
            qrCodeContainer.classList.remove('hidden');
        }

        // --- MAIN LOGIC ---
        // This runs as soon as the page has loaded.
        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const seed = urlParams.get('seed');

            if (seed) {
                // If a 'seed' parameter exists in the URL, show the Participant View.
                organizerView.style.display = 'none';
                participantView.style.display = 'block';
                createSeededCard(seed);
            } else {
                // If there's no 'seed', show the Organizer View.
                participantView.style.display = 'none';
                organizerView.style.display = 'block';
                generateLinkBtn.addEventListener('click', handleGenerateLink);
            }
        };
    </script>
</body>
</html>
